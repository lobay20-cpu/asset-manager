{% extends "base.html" %}

{% block title %}Szczegóły - {{ urzadzenie.nazwa }}{% endblock %}

{% block content %}
    <hgroup>
        <h1>{{ urzadzenie.nazwa }}</h1>
        <h2>{{ urzadzenie.identyfikator_sprzetu }}</h2>
    </hgroup>

<!-- NOWY, POPRAWIONY KONTENER NA PRZYCISKI -->
    <div role="group">
        <a href="{{ url_for('edytuj_urzadzenie', urzadzenie_id=urzadzenie.id) }}" role="button">Edytuj dane</a>
        
        <a href="{{ url_for('pokaz_qr', urzadzenie_id=urzadzenie.id) }}" role="button" class="secondary outline">
            <svg ...> ... </svg> Pokaż Kod QR
        </a>
        
        <a href="{{ url_for('usun_urzadzenie', urzadzenie_id=urzadzenie.id) }}" class="contrast outline" role="button" onclick="return confirm('Czy na pewno chcesz trwale usunąć to urządzenie i całą jego historię?')">Usuń urządzenie</a>
    </div>

    <article>

    <article>
        <p><strong>Grupa:</strong> {{ urzadzenie.grupa.nazwa_grupy }}</p>
        <p><strong>Producent:</strong> {{ urzadzenie.producent }}</p>
        <p><strong>Numer seryjny:</strong> {{ urzadzenie.nr_seryjny }}</p>
        <p><strong>Data zakupu:</strong> {{ urzadzenie.data_zakupu.strftime('%Y-%m-%d') if urzadzenie.data_zakupu }}</p>
        <p><strong>Aktualny IMEI SIM:</strong> {{ urzadzenie.aktualny_imei_sim }}</p>
    </article>

    <h3>Historia Zmian</h3>
    
    <table>
        <thead>
            <tr>
                <th>Data</th>
                <th>Lokalizacja</th>
                <th>Status</th>
                <th>Pracownik</th>
                <th>Uwagi</th>
            </tr>
        </thead>
        <tbody>
            {% for wpis in urzadzenie.historia | reverse %}
            <tr>
                <td>{{ wpis.data_zmiany.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>{{ wpis.lokalizacja }}</td>
                <td><span class="status-tag status-{{ wpis.status | lower | replace(' ', '-') | replace('ż', 'z') | replace('ę', 'e') }}">{{ wpis.status }}</span></td>```
                <td>{{ wpis.uzytkownik.imie_nazwisko }}</td>
                <td>{{ wpis.uwagi }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5">Brak historii zmian dla tego urządzenia.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}